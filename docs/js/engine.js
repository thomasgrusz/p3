import{Resources}from"./resources.js";import{app,player,timer}from"./app.js";const doc=document,win=window,canvas=doc.createElement("canvas");export let ctx=canvas.getContext("2d");let lastTime;function main(){let e=Date.now(),a=(e-lastTime)/1e3;player.startScreenDisplay&&startScreen(),player.characterSelectedFlag||player.startScreenDisplay||selectPlayer(),!app.pauseFlag&&player.characterSelectedFlag&&player.alive&&!player.gameWon&&(update(a),render()),player.alive||gameOver(),player.gameWon&&gameWon(),lastTime=e,win.requestAnimationFrame(main)}function init(){reset(),lastTime=Date.now(),main()}function update(e){updateEntities(e),checkCollisions()}function updateEntities(e){app.allEnemies.forEach((a=>{a.update(e)})),app.allCollectibles.forEach((e=>{e.update()})),player.update()}function checkCollisions(){app.allEnemies.forEach((e=>{player.collisionDetect(e)})),app.allCollectibles.forEach((e=>{player.collisionDetect(e)}))}function render(){renderBackground(),renderEntities()}function renderBackground(){const e=["images/water-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/grass-block.png","images/grass-block.png"];for(let a=0;a<6;a++)for(let t=0;t<5;t++)ctx.drawImage(Resources.get(e[a]),101*t,83*a)}function renderEntities(){app.allCollectibles.forEach((e=>{e.render()})),app.allRocks.forEach((e=>{e.render()})),app.allEnemies.forEach((e=>{e.render()})),player.render(),player.renderScore(),timer.render()}function reset(){app.allEnemies.forEach((e=>{e.reset()})),app.allCollectibles.forEach((e=>{e.reset()})),app.allRocks.forEach((e=>{e.reset()})),player.reset(),timer.reset(),app.pauseFlag=!1}function selectPlayer(){renderBackground(),app.displayPanel(30,200,445,210,"white"),app.displayPanelOutline(30,200,445,210,"green");for(let e=0;e<player.characters.length;e++)ctx.drawImage(Resources.get(player.characters[e]),20+90*e,180);ctx.font="20pt Lobster",ctx.fillStyle="green",ctx.fillText("select your hero and press ENTER!",75,400),app.displayPanelOutline(player.selectorBoxXCoords[player.selectorBox],220,63,110,"lightgreen")}function startScreen(){if(renderBackground(),app.displayPanel(30,120,445,380,"white"),app.displayPanelOutline(30,120,445,380,"green"),ctx.font="32pt Lobster",ctx.fillStyle="green",ctx.fillText("GAME INFO",140,200),ctx.font="20pt Lobster",ctx.fillText("get 200 points in 60 seconds",100,270),ctx.fillText("- reach water = 10 points",120,330),ctx.fillText("- blue gem = 80 points",120,360),ctx.fillText("- green gem = 50 points",120,390),ctx.fillText("- orange gem = 30 points",120,420),ctx.fillStyle="red",ctx.fillText("press return to start!",150,480),!0===player.startFirstGame){player.startScreenDisplay=!1;const e=doc.querySelector("footer");e.innerHTML="";const a=doc.createElement("h4"),t=doc.createTextNode("press SPACE to pause game");a.appendChild(t),e.appendChild(a),init()}}function gameOver(){renderBackground(),player.renderScore(),app.displayPanel(30,200,445,210,"white"),app.displayPanelOutline(30,200,445,210,"green"),ctx.font="30pt Lobster",ctx.fillStyle="green",ctx.fillText("GAME OVER!",140,300),ctx.font="20pt Lobster",ctx.fillStyle="green",ctx.fillText("press return for another game!",90,350),!0===player.anotherGameFlag&&(player.anotherGameFlag=!1,init())}function gameWon(){renderBackground(),timer.render(),app.displayPanel(30,200,445,210,"white"),app.displayPanelOutline(30,200,445,210,"green"),ctx.font="30pt Lobster",ctx.fillStyle="red",ctx.fillText("YOU ARE A WINNER!",70,300),ctx.font="20pt Lobster",ctx.fillStyle="green",ctx.fillText("press return for another game!",90,350),!0===player.anotherGameFlag&&(player.anotherGameFlag=!1,init())}function loadResources(){Resources.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png","images/Heart.png","images/Gem Blue.png","images/Gem Green.png","images/Gem Orange.png","images/Rock.png"]),Resources.onReady(init)}canvas.width=505,canvas.height=606,doc.querySelector("#gameCanvas").appendChild(canvas);export default loadResources;